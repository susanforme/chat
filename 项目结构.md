## 路由设计

**注意敏感操作必须用 check 鉴权**

**也能直接通过判断 cookie 是否存在**

**跨域部分打包删除**

### home

| url  | method | body | response | 备注 |
| ---- | ------ | ---- | -------- | ---- |
| /    | get    |      |          |      |

### user

**都以 user 开头,如/user/xxx**

| url               | method | body                                                         | response                                                     |
| ----------------- | ------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| /login            | post   | {userName:string, password:string}                           | {status:1,data:{userName:string,id:string}}                  |
| /logout           | get    |                                                              | {status:1}                                                   |
| /register         | post   | {userName:string ,password:string}                           | {status:1,data:{userName:string,id:string}}                  |
| /captcha          | get    |                                                              | {status:1,data:{imgPath:string,text:string}}                 |
| /profile/:id      | get    |                                                              | {status:1,data:{userName,headImg,buyCount,sellCount,totalCount}} |
| /personal/:id     | get    | {status:data:{commodity:[]  ,evaluate:[createTime,evaluate,user:{}]}} |                                                              |
| /check            | get    |                                                              |                                                              |
| /balance/:id      | get    |                                                              |                                                              |
| /balance          | post   | {id:string, updateBalance:number}                            | {status:1}                                                   |
| /location         | post   | {name,userId,area,phoneNum}                                  | {status:1,data:{}[]}  返回所有地址                           |
| /location/:id     | get    |                                                              | {status:1,data:[{area,name,phoneNum,id}]}                    |
| /location/:id_pId | delete | pid为地址的id                                                | {status:!}                                                   |

| o    | url           | method | 备注                                                         |
| ---- | ------------- | ------ | ------------------------------------------------------------ |
| √    | /login        | post   | 登录 md5 加密                                                |
| √    | /logout       | get    | 退出,                                                        |
| √    | /register     | post   | 注册 md5 加密                                                |
| √    | /captcha      | get    | 返回验证码                                                   |
| √    | /profile/:id  | get    | 根据 id 返回用户信息                                         |
| √    | /personal/:id | get    | 个人主页,有评价,和发布的商品                                 |
| √    | /check        | get    | (带上 cookie,判断权限)敏感操作必须检验,根据 cookie 来进行 id 获取 |
| √    | /balance/:id  | get    | 获得余额                                                     |
| √    | /balance      | post   | 更改余额,如果是增加传正数,如果是购买行为传负数               |

### chat

**都以 chat 开头,如/chat/xxx**

| o    | url          | method | body       | response                                                     | 备注                                              |
| ---- | ------------ | ------ | ---------- | ------------------------------------------------------------ | ------------------------------------------------- |
| √    | /msglist/:id | get    | id为用户id | {status:1,data:{id,userName,headImg}[]                       | 这个消息列表是在点击消息页面,获取所有有过聊天的人 |
| √    | /history/:id | get    |            | {status:1,data:{send:{},receive:{},msg:string,createTime:string}[]} | id为两个人id拼接而成以_为间隔                     |

### admin

**都以 admin 开头,如/admin/xxx**

| o    | url       | method | body                      | response                      | 备注                       |
| ---- | --------- | ------ | ------------------------- | ----------------------------- | -------------------------- |
|      | /login    | post   | {userName,password}       | {status:1,data:{id,userName}} |                            |
|      | /register | post   | {userName,password,token} | {status:1,data:{id,userName}} | 必须使用环境变量中的 token |

### commodity

**都以 commodity 开头,如/commodity/xxx**

| o    | url                 | method | body                                                         | response                                                     |
| ---- | ------------------- | ------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| √    | /kind               | get    | 请求有哪些商品分类                                           | {status:1,data:{kind:[{name,imgPath,id}]}}                   |
| √    | /classification/:id | get    | 某个商品分类下的 id为分类id                                  | {status:1,data:[id,user:{userName,headimg},imgPath,price,description  ]} |
| √    | /recommend          | get    |                                                              | {status:1,data:[id,user:{userName,headimg},imgPath,price,description  ]} |
| √    | /comment            | post   | {commodityId,comment,userId}                                 | {status:1,data:{commodityId,comment,userId}}                 |
| √    | /info/:id           | get    | 商品详情                                                     | {createtime,imgPath:[],isSale,comment:[],id,owner,name,kind,price,description} |
| √    | /info               | post   | {owner,name,kind,price,description,imgPath?}                 | 原样返回                                                     |
| √    | /order              | post   | {commodityId,receive:{area,phoneNum,name},buyerId,sellerId,evaluate?} |                                                              |
| √    | /search/:name       | get    | 根据商品名字模糊查询                                         |                                                              |

### upload

**都以 upload 开头,如/upload/xxx**

| o    | url  | method | body                         | response |
| ---- | ---- | ------ | ---------------------------- | -------- |
| √    | /img | post   | 上传文件(需要以表单形式提交) |          |

### socket 接口

| o    | body                                  | response                                    | 备注                                    |
| ---- | ------------------------------------- | ------------------------------------------- | --------------------------------------- |
| √    | {send: id; receive: id; msg: string;} | {status:1,data:{...body,createTime:string}} | emit('caht')发送信息,on('back')获得信息 |



## manage

后台管理相关接口

| o    | url   | method | body               | response |
| ---- | ----- | ------ | ------------------ | -------- |
|      | /kind | post   | {kindName,imgPath} |          |
|      |       |        |                    |          |
|      |       |        |                    |          |



## 备注

- status
  - 0 失败
  - 1 成功

## 备忘

1. 获取 ip 归属地 http://ip-api.com/json/?lang=zh-CN
2. 注意在关键路由使用 session 鉴权登录
3. 规定返回格式
4. 登录先在本地进行一次 md5 加密
5. 在服务器端对密码进行二次加密,加上一个加密字符串
6. 反向代理
7. **最后删除所有 view render**
8. get 查询参数变为 id 后半段
9. 图片注意访问万象数据
10. axios拦截器
11. 后端拦截session鉴权
