## 路由设计

**注意敏感操作必须用 check 鉴权**

**也能直接通过判断 cookie 是否存在**

### home

| url | method | query | body | response | 备注 |
| --- | ------ | ----- | ---- | -------- | ---- |
| /   | get    |       |      |          |      |

### user

**都以 user 开头,如/user/xxx**

| url       | method | query      | body                               | response                                     |
| --------- | ------ | ---------- | ---------------------------------- | -------------------------------------------- |
| /login    | post   |            | {userName:string, password:string} | {status:1,data:{userName:string,id:string}}  |
| /logout   | get    |            |                                    | {status:1}                                   |
| /register | post   |            | {userName:string ,password:string} | {status:1,data:{userName:string,id:string}}  |
| /captcha  | get    |            |                                    | {status:1,data:{imgPath:string,text:string}} |
| /profile  | get    | ?id=string |                                    | {status:1,data:{}}                           |
| /check    | get    |            |                                    |                                              |
| /balance  | get    | ?id=string |                                    |                                              |
| /balance  | post   |            | {id:string, updateBalance:number}  | {status:1}                                   |

| url       | method | 备注                                                              |
| --------- | ------ | ----------------------------------------------------------------- |
| /login    | post   | 登录 md5 加密                                                     |
| /logout   | get    | 退出                                                              |
| /register | post   | 注册 md5 加密                                                     |
| /captcha  | get    | 返回验证码                                                        |
| /profile  | get    | 根据 id 返回用户信息                                              |
| /check    | get    | (带上 cookie,判断权限)敏感操作必须检验,根据 cookie 来进行 id 获取 |
| /balance  | get    | 获得余额                                                          |
| /balance  | post   | 更改余额,如果是增加传正数,如果是购买行为传负数                    |

### chat

**都以 chat 开头,如/chat/xxx**

| url      | method | query      | body               | response                                                            | 备注               |
| -------- | ------ | ---------- | ------------------ | ------------------------------------------------------------------- | ------------------ |
| /msglist | get    | ?id=string |                    | {status:1,data:string[]                                             | 返回数据为 id 集合 |
| /history | post   |            | {userIds:string[]} | {status:1,data:{send:{},receive:{},msg:string,createTime:string}[]} |                    |

### admin

**都以 admin 开头,如/admin/xxx**

| url       | method | query | body                      | response                      | 备注                       |
| --------- | ------ | ----- | ------------------------- | ----------------------------- | -------------------------- |
| /login    | post   |       | {userName,password}       | {status:1,data:{id,userName}} |                            |
| /register | post   |       | {userName,password,token} | {status:1,data:{id,userName}} | 必须使用环境变量中的 token |
|           |        |       |                           |                               |                            |

### commodity

**都以 commodity 开头,如/commodity/xxx**

| url   | method | query | body | response                                | 备注     |
| ----- | ------ | ----- | ---- | --------------------------------------- | -------- |
| /kind | get    |       |      | {status:1,data:{kind:[{name,imgPath}]}} | 商品分类 |
|       |        |       |      |                                         |          |
|       |        |       |      |                                         |          |

## socket 接口

| body                                                                                                | response                                    | 备注                                    |
| --------------------------------------------------------------------------------------------------- | ------------------------------------------- | --------------------------------------- |
| {send: { id: string; userName: string; }; receive: { id: string; userName: string; }; msg: string;} | {status:1,data:{...body,createTime:string}} | emit('caht')发送信息,on('back')获得信息 |

## 备注

- status
  - 0 失败
  - 1 成功

## 备忘

1. 获取 ip 归属地 http://ip-api.com/json/?lang=zh-CN
2. 注意在关键路由使用 session 鉴权登录
3. 规定返回格式
4. 登录先在本地进行一次 md5 加密
5. 在服务器端对密码进行二次加密,加上一个加密字符串
6. 反向代理
7. **最后删除所有 view render**
8. get 查询参数变为 id 后半段
